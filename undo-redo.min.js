//JS-undo-redo v0.7
function undoRedo(n,t,e){e=e||10,t=t||3e4;var o,r=[],s=[],l=localStorage;function a(){var t={l:1},l=JSON.stringify(n);o&&JSON.stringify(o)==l||(o&&(r.push(o),r.length>e&&r.shift(),t.u=1),s.length>0&&(s.length=0,t.r=1),o=JSON.parse(l),u(t))}function i(n,t){if((n=n||{}).length+""!="undefined")for(;n.length>t.length;)n.pop();for(var e in t)"object"==typeof t[e]?n[e]=i(n[e],t[e]):n[e]=t[e];return n}function u(n){(n=n||{u:1,l:1,r:1}).u&&(l.stUndo=JSON.stringify(r)),n.r&&(l.stRedo=JSON.stringify(s)),n.l&&(l.lastSav=JSON.stringify(o))}return l.lastSav&&(o=JSON.parse(l.lastSav),i(n,o),l.stUndo&&(r=JSON.parse(l.stUndo)),l.stRedo&&(s=JSON.parse(l.stRedo))),t>0&&setInterval(a,t),{save:a,undo:function(){a(),r.length>0&&(s.push(o),o=r.pop(),i(n,o),u())},redo:function(){a(),s.length>0&&(r.push(o),o=s.pop(),i(n,o),u())},clear:function(){localStorage.clear(),o=!1,r.length=0,s.length=0},hasUndo:function(){return r.length>0},hasRedo:function(){return s.length>0}}}
